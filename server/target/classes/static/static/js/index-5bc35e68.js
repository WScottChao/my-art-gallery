var ae=Object.defineProperty,ne=Object.defineProperties;var oe=Object.getOwnPropertyDescriptors;var W=Object.getOwnPropertySymbols;var se=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var J=(a,o,n)=>o in a?ae(a,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[o]=n,B=(a,o)=>{for(var n in o||(o={}))se.call(o,n)&&J(a,n,o[n]);if(W)for(var n of W(o))le.call(o,n)&&J(a,n,o[n]);return a},L=(a,o)=>ne(a,oe(o));var I=(a,o,n)=>new Promise((s,u)=>{var p=r=>{try{h(n.next(r))}catch(b){u(b)}},m=r=>{try{h(n.throw(r))}catch(b){u(b)}},h=r=>r.done?s(r.value):Promise.resolve(r.value).then(p,m);h((n=n.apply(a,o)).next())});import{d as ce,E as X,G as U,a as O,I as R,W as V,j as c,k as f,c as P,e as l,w as i,b as y,n as F,t as A,F as Y,l as Z,C as H,Q as q,D as K,U as G,f as Q,a6 as ie,a7 as re,z as ee,o as de,aa as pe,L as me,M as ue,N as _e}from"./index-9e787fa5.js";import{i as ge}from"./icon-caec1666.js";import{p as fe,d as ye,a as he}from"./project-c1868b8d.js";const be={key:0,class:"go-items-list-card"},ve={class:"list-content"},we={class:"list-content-top"},ke={class:"go-flex-items-center list-footer",justify:"space-between"},Te={class:"go-flex-items-center list-footer-ri"},xe=ce({__name:"index",props:{cardData:Object},emits:["preview","delete","resize","edit","release"],setup(a,{emit:o}){const n=X(),s="http://127.0.0.1:8083",{TrashIcon:u,BrowsersOutlineIcon:p,HammerIcon:m,SendIcon:h}=ge.ionicons5,r=o,b=U(()=>n.templateTypeMapping),C=(_="")=>_==""?"":n.getTemplateTypeInfo(_).label||"",v=a,t=O([{label:R("global.r_edit"),key:"edit",icon:V(m)},{label:R("global.r_publish"),key:"preview",icon:V(h)},{label:R("global.r_delete"),key:"delete",icon:V(u)}]),e=_=>{switch(_){case"preview":k();break;case"delete":T();break;case"release":M();break;case"edit":z();break}},x=(_,w)=>{switch(_){case"preview":return(w==null?void 0:w.state)!=1;default:return!0}},k=()=>{r("preview",v.cardData)},T=()=>{r("delete",v.cardData)},z=()=>{r("edit",v.cardData)},M=()=>{r("release",v.cardData)},S=()=>{r("resize",v.cardData)};return(_,w)=>{const D=c("n-text"),$=c("n-image"),d=c("n-button"),j=c("n-tooltip"),E=c("n-space"),te=c("n-card");return a.cardData?(f(),P("div",be,[l(te,{hoverable:"",size:"small"},{action:i(()=>[y("div",ke,[l(D,{class:"go-ellipsis-1"},{default:i(()=>[F(A(a.cardData.templateName||a.cardData.id||"未命名"),1)]),_:1}),y("div",Te,[l(E,null,{default:i(()=>[(f(!0),P(Y,null,Z(t,g=>(f(),H(j,{key:g.key,placement:"bottom",trigger:"hover"},{trigger:i(()=>[q(l(d,{size:"small",onClick:N=>e(g.key)},{icon:i(()=>[(f(),H(K(g.icon)))]),_:2},1032,["onClick"]),[[G,x(g.key,a.cardData)]])]),default:i(()=>[(f(),H(K(g.label)))]),_:2},1024))),128))]),_:1})])])]),default:i(()=>[y("div",ve,[y("div",we,[l(D,null,{default:i(()=>{var g,N;return[F(A(b.value[(g=a.cardData)==null?void 0:g.templateType])+"类型-"+A(C((N=a.cardData)==null?void 0:N.typeId)),1)]}),_:1})]),y("div",{class:"list-content-img",onClick:S},[l($,{"object-fit":"contain",height:"180","preview-disabled":"",src:`${Q(s)}/${a.cardData.indexImage}?time=${new Date().getTime()}`,alt:a.cardData.templateName,"fallback-src":Q(ie)()},null,8,["src","alt","fallback-src"])])])]),_:1})])):re("",!0)}}});const De=ee(xe,[["__scopeId","data-v-683dfe3b"]]);const Ie={class:"go-project-statistical-template"},He={class:"list-pagination"},Pe={__name:"index",setup(a){const o=X(),n=U(()=>[{type:"group",label:"基础类型",key:"group1",children:o.template_type_list_basic},{type:"group",label:"综合类型",key:"group2",children:o.template_type_list_synthesis}]),s=O({loading:!0,searchParam:{name:null,startTime:null,endTime:null,typeId:null},tableData:[]});let u=U({get(){let{startTime:t,endTime:e}=s.searchParam;return!t&&!e?null:[t,e]},set(t){s.searchParam.startTime=(t==null?void 0:t[0])||null,s.searchParam.endTime=(t==null?void 0:t[1])||null}});const p=O({page:1,limit:10,count:10});de(()=>{m()});const m=()=>I(this,null,function*(){s.loading=!0;let t=L(B({},s.searchParam),{page:p.page,limit:p.limit});try{const e=yield fe(t);if((e==null?void 0:e.code)==200){const{count:x}=e;p.count=x,s.tableData=e.data.map(k=>L(B({},k),{release:k.state!==-1}))}setTimeout(()=>{s.loading=!1},500)}catch(e){s.loading=!1}}),h=t=>{if(!t)return;const e=me(ue.CHART_HOME_NAME,"href");_e(e,[t.id],void 0,!0)},r=t=>I(this,null,function*(){if(t)try{const e=yield ye({ids:t.id});(e==null?void 0:e.code)==200&&(window.$message.success("删除成功!"),m())}catch(e){}}),b=t=>I(this,null,function*(){if(t)try{const e=yield he({id:t.id,state:t.state==1?-1:1});(e==null?void 0:e.code)==200&&(window.$message.success("发布成功!"),m())}catch(e){}}),C=t=>{p.page=t,m()},v=t=>{p.limit=t,m()};return(t,e)=>{const x=c("go-loading"),k=c("n-input"),T=c("n-form-item"),z=c("n-select"),M=c("n-date-picker"),S=c("n-button"),_=c("n-form"),w=c("n-grid-item"),D=c("n-grid"),$=c("n-pagination");return f(),P("div",Ie,[q(y("div",null,[l(x)],512),[[G,s.loading]]),q(y("div",null,[l(_,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:i(()=>[l(T,{label:"模板名称"},{default:i(()=>[l(k,{placeholder:"输入模板名称",value:s.searchParam.name,"onUpdate:value":e[0]||(e[0]=d=>s.searchParam.name=d),clearable:""},null,8,["value"])]),_:1}),l(T,{label:"类型"},{default:i(()=>[l(z,{filterable:"",options:n.value,"value-field":"id",style:{width:"240px"},"max-tag-count":1,value:s.searchParam.typeId,"onUpdate:value":e[1]||(e[1]=d=>s.searchParam.typeId=d),clearable:""},null,8,["options","value"])]),_:1}),l(T,{label:"创建时间"},{default:i(()=>[l(M,{"formatted-value":Q(u),"onUpdate:formattedValue":e[2]||(e[2]=d=>pe(u)?u.value=d:u=d),"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",clearable:""},null,8,["formatted-value"])]),_:1}),l(T,null,{default:i(()=>[l(S,{ghost:"",onClick:m},{default:i(()=>[F(" 筛选 ")]),_:1})]),_:1})]),_:1},512),l(D,{"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:4 xl:4 xxl:4",responsive:"screen"},{default:i(()=>[(f(!0),P(Y,null,Z(s.tableData,(d,j)=>(f(),H(w,{key:d.id},{default:i(()=>[l(De,{cardData:d,onPreview:b,onDelete:E=>r(d),onRelease:E=>t.releaseHandle(d,j),onEdit:h},null,8,["cardData","onDelete","onRelease"])]),_:2},1024))),128))]),_:1})],512),[[G,!s.loading]]),y("div",He,[l($,{page:p.page,"page-size":p.limit,"item-count":p.count,"page-sizes":[12,24,36,48],"onUpdate:page":C,"onUpdate:pageSize":v,"show-size-picker":""},null,8,["page","page-size","item-count"])])])}}},$e=ee(Pe,[["__scopeId","data-v-23d7d337"]]);export{$e as default};
