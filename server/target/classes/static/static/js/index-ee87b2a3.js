var d=(v,f,i)=>new Promise((S,u)=>{var g=a=>{try{n(i.next(a))}catch(c){u(c)}},r=a=>{try{n(i.throw(a))}catch(c){u(c)}},n=a=>a.done?S(a.value):Promise.resolve(a.value).then(g,r);n((i=i.apply(v,f)).next())});import{M as V}from"./EditorWorker-81155e63.js";import"./editorWorker-43a98755.js";import{d as A,r as B,aQ as w,aR as j,aA as D,aS as h,aT as J,aU as L,c as M,e as t,w as o,aN as F,j as s,k as y,b as z,n as p,f as m,C as x,a7 as O,z as U}from"./index-9e787fa5.js";import{g as G}from"./storage-63273458.js";import"./querySelectorAll-a1c431d2.js";import{g as b}from"./plugin-e1dac962.js";import{i as H}from"./icon-caec1666.js";import{u as K}from"./useSync.hook-87506693.js";import{u as Q,P as q}from"./chartEditStore-56d3c83a.js";import"./project-c1868b8d.js";import"./index-f6f97c94.js";import"./SettingItem-264e825b.js";/* empty css                                                                      */import"./SettingItemBox-ee4024ad.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-374cf080.js";import"./index.esm.min-33db7d4b.js";import"./fileTypeEnum-21359a08.js";import"./chartLayoutStore-58ece452.js";const W={class:"go-edit"},X=A({__name:"index",setup(v){const f=Q(),{dataSyncUpdate:i}=K(),{ChevronBackOutlineIcon:S,DownloadIcon:u,AnalyticsIcon:g}=H.ionicons5,r=window.showOpenFilePicker,n=B("");window.$message.warning("请不要刷新此窗口！");function a(){return d(this,null,function*(){const e=yield G();F(`编辑-${e.editCanvasConfig.projectName}`),n.value=h(e)})}setTimeout(a);function c(){b({message:"导入数据将覆盖内容，此操作不可撤回，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const _=yield(yield r())[0].getFile(),l=new FileReader;l.readAsText(_),l.onloadend=()=>{n.value=(l.result||"").toString()},window.$message.success("导入成功！")}catch(e){window.$message.error("导入失败，请检查文件是否损坏！"),console.log(e)}})})}window.opener.addEventListener(w.CHART,e=>{window.$message.success("正在进行更新..."),j(D.GO_CHART_STORAGE_LIST,[e.detail]),n.value=h(e.detail)}),document.addEventListener("keydown",function(e){e.keyCode==83&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),C())});function C(){return d(this,null,function*(){if(!window.opener)return window.$message.error("源窗口已关闭，视图同步失败！");b({message:"是否覆盖源视图内容? 此操作不可撤！",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>d(this,null,function*(){try{const e=J(n.value);delete e.id,i&&(f.setProjectInfo(q.PROJECT_ID,L()),yield i(!1)),window.opener.dispatchEvent(new CustomEvent(w.JSON,{detail:e})),window.$message.success("正在同步内容...")}catch(e){window.$message.error("内容格式有误"),console.log(e)}})})})}return window.onbeforeunload=()=>{window.opener&&window.opener.dispatchEvent(new CustomEvent(w.CLOSE))},(e,_)=>{const l=s("n-text"),k=s("n-icon"),E=s("n-button"),N=s("n-tag"),P=s("n-space"),I=s("n-layout-header"),T=s("n-layout-content"),$=s("n-layout");return y(),M("div",W,[t($,null,{default:o(()=>[t(I,{class:"go-edit-header go-px-5 go-flex-items-center",bordered:""},{default:o(()=>[z("div",null,[t(l,{class:"go-edit-title go-mr-4"},{default:o(()=>[p("页面在线编辑器")]),_:1}),m(r)?(y(),x(E,{key:0,class:"go-mr-3",size:"medium",onClick:c},{icon:o(()=>[t(k,null,{default:o(()=>[t(m(u))]),_:1})]),default:o(()=>[p(" 导入 ")]),_:1})):O("",!0)]),t(P,null,{default:o(()=>[t(N,{bordered:!1,type:"warning"},{default:o(()=>[p(" 「Ctrl + S 更新视图」 ")]),_:1}),m(r)?(y(),x(E,{key:0,class:"go-mr-3",size:"medium",onClick:C},{icon:o(()=>[t(k,null,{default:o(()=>[t(m(g))]),_:1})]),default:o(()=>[p(" 保存 ")]),_:1})):O("",!0)]),_:1})]),_:1}),t(T,null,{default:o(()=>[t(m(V),{modelValue:n.value,"onUpdate:modelValue":_[0]||(_[0]=R=>n.value=R),language:"json",editorOptions:{lineNumbers:"on",minimap:{enabled:!0}}},null,8,["modelValue"])]),_:1})]),_:1})])}}});const we=U(X,[["__scopeId","data-v-607ca42c"]]);export{we as default};
