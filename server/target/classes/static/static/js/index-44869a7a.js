var ve=Object.defineProperty,he=Object.defineProperties;var ye=Object.getOwnPropertyDescriptors;var se=Object.getOwnPropertySymbols;var be=Object.prototype.hasOwnProperty,qe=Object.prototype.propertyIsEnumerable;var le=(o,r,d)=>r in o?ve(o,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[r]=d,W=(o,r)=>{for(var d in r||(r={}))be.call(r,d)&&le(o,d,r[d]);if(se)for(var d of se(r))qe.call(r,d)&&le(o,d,r[d]);return o},Q=(o,r)=>he(o,ye(r));var de=(o,r,d)=>new Promise((v,R)=>{var q=u=>{try{m(d.next(u))}catch(w){R(w)}},p=u=>{try{m(d.throw(u))}catch(w){R(w)}},m=u=>u.done?v(u.value):Promise.resolve(u.value).then(q,p);m((d=d.apply(o,r)).next())});import{d as L,r as T,H as Z,j as n,k as c,C as N,w as t,e,n as h,c as $,b as _,f as a,z as V,bn as _e,O as pe,Y as ee,G,a7 as ae,F as Y,l as ne,ab as re,t as F,p as we,q as xe,a as Pe,da as A,aY as X,d9 as ce,aZ as M,au as De,J as Ie,bi as Ce,aW as ue,as as K,bh as Se,cJ as ke,by as Re,bz as $e}from"./index-9e787fa5.js";import{i as te}from"./icon-caec1666.js";/* empty css                                                                      */import{S as B}from"./SettingItemBox-ee4024ad.js";import{r as Ee}from"./chartEditStore-56d3c83a.js";import{n as Oe}from"./noData-e5cefb25.js";import{u as oe}from"./useTargetData.hook-986612b2.js";import{g as me}from"./plugin-e1dac962.js";import"./index-ff998c2f.js";import{R as He,a as Te}from"./pondIndex.vue_vue_type_style_index_0_scoped_b8b31a18_lang-6e695383.js";import"./EditorWorker-81155e63.js";import"./editorWorker-43a98755.js";import"./index-f6f97c94.js";import"./chartLayoutStore-58ece452.js";import{u as Ue}from"./useSync.hook-87506693.js";import{S as j}from"./SettingItem-264e825b.js";import{C as ze}from"./index-e0a81839.js";import"./index-81fca23c.js";import"./index.vue_vue_type_script_setup_true_lang-1414f1f1.js";import"./index-567c51a3.js";import"./CollapseItem.vue_vue_type_script_setup_true_lang-374cf080.js";import"./index.esm.min-33db7d4b.js";import"./fileTypeEnum-21359a08.js";import"./project-c1868b8d.js";const Ne={class:"go-pr-3"},Be={key:1},Ae=L({__name:"pondIndex",props:{modelShow:Boolean,targetDataRequest:Object},emits:["update:modelShow","editSaveHandle"],setup(o,{emit:r}){const d=o,v=r,{dataSyncUpdate:R}=Ue();T();const q=T(),p=T(!1);Z(()=>d.modelShow,x=>{p.value=x});const m=()=>{v("update:modelShow",!1)},u=()=>{var x,l;if(!((x=d.targetDataRequest)!=null&&x.dataPondName)){window.$message.warning("请在左下角输入名称！"),(l=q.value)==null||l.focus();return}me({message:"保存内容将同步修改所有使用此接口的组件, 是否继续?",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{v("update:modelShow",!1),v("editSaveHandle",d.targetDataRequest),R()}})},w=()=>{m()};return(x,l)=>{const P=n("n-space"),D=n("n-scrollbar"),y=n("n-tag"),U=n("n-input"),E=n("n-button"),C=n("n-card"),z=n("n-modal");return c(),N(z,{class:"go-chart-data-request",show:p.value,"onUpdate:show":l[1]||(l[1]=S=>p.value=S),"mask-closable":!1,closeOnEsc:!0,onEsc:w},{default:t(()=>[e(C,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"1000px",height:"800px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(P,{justify:"space-between"},{default:t(()=>[o.targetDataRequest?(c(),N(P,{key:0},{default:t(()=>[e(y,{bordered:!1,type:"primary"},{default:t(()=>[h("名称：")]),_:1}),e(U,{value:o.targetDataRequest.dataPondName,"onUpdate:value":l[0]||(l[0]=S=>o.targetDataRequest.dataPondName=S),ref_key:"inputInstRef",ref:q,type:"text",size:"small",autofocus:!0,clearable:!0,minlength:1,maxlength:16,placeholder:"请输入名称"},null,8,["value"])]),_:1})):(c(),$("span",Be)),e(P,null,{default:t(()=>[e(E,{onClick:m},{default:t(()=>[h("取消")]),_:1}),e(E,{type:"primary",onClick:u},{default:t(()=>[h("保存")]),_:1})]),_:1})]),_:1})]),default:t(()=>[e(D,{style:{"max-height":"718px"}},{default:t(()=>[_("div",Ne,[e(P,{vertical:""},{default:t(()=>{var S;return[e(a(He)),e(a(Te),{"target-data-request":(S=o.targetDataRequest)==null?void 0:S.dataPondRequestConfig},null,8,["target-data-request"])]}),_:1})])]),_:1})]),_:1})]),_:1},8,["show"])}}}),Fe=V(Ae,[["__scopeId","data-v-b8b31a18"]]),je=o=>(we("data-v-57909643"),o=o(),xe(),o),Le={class:"go-chart-data-pond-list"},Me={class:"pond-item-box"},Ge=je(()=>_("span",null," 创建 ",-1)),Ve=["onClick"],Ye={class:"item-content"},Je={class:"item-content-body"},We=["onClick"],Qe=L({__name:"index",emits:["createPond","deletePond"],setup(o,{emit:r}){_e(y=>({e1c1f336:x.value}));const d=r,{DuplicateOutlineIcon:v,TrashIcon:R}=te.ionicons5,q=pe(),{chartEditStore:p,targetData:m}=oe(),{requestDataPond:u}=ee(p.getRequestGlobalConfig),w=G(()=>m.value.request.requestDataPondId),x=G(()=>q.getAppTheme),l=()=>{d("createPond",!0)},P=(y,U)=>{y.stopPropagation(),y.preventDefault(),d("deletePond",U)},D=y=>{m.value.request.requestDataPondId=y.dataPondId};return(y,U)=>{const E=n("n-timeline-item"),C=n("n-timeline"),z=n("n-icon"),S=n("n-button"),k=n("n-divider"),f=n("n-a"),O=n("n-text"),s=n("n-space"),i=n("n-tag"),b=n("n-ellipsis"),g=n("n-scrollbar");return c(),$("div",Le,[e(C,{class:"pond-item-timeline",style:{width:"20px"}},{default:t(()=>[e(E,{type:"info"}),e(E,{type:"success"})]),_:1}),_("div",Me,[e(S,{class:"create-btn go-py-4",ghost:"",onClick:l},{icon:t(()=>[e(z,null,{default:t(()=>[e(a(v))]),_:1})]),default:t(()=>[Ge]),_:1}),e(k,{style:{margin:"10px 0"}}),a(u).length?ae("",!0):(c(),N(s,{key:0,justify:"center"},{default:t(()=>[e(O,{class:"not-layer-text",depth:3},{default:t(()=>[h(" 暂无数据内容， "),e(f,{onClick:l},{default:t(()=>[h("立即创建")]),_:1})]),_:1})]),_:1})),e(g,{style:{"max-height":"490px"}},{default:t(()=>[(c(!0),$(Y,null,ne(a(u),I=>(c(),$("div",{key:I.dataPondId,class:re([{select:I.dataPondId===w.value},"pond-item"]),onClick:H=>D(I)},[_("div",Ye,[_("div",Je,[_("div",null,[e(i,{class:"go-mr-1",type:I.dataPondId===w.value?"warning":"",bordered:!1},{default:t(()=>[h(" 名称 ")]),_:2},1032,["type"]),e(b,{style:{"max-width":"180px"}},{default:t(()=>[h(F(I.dataPondName||"暂无"),1)]),_:2},1024)]),_("div",null,[e(i,{class:"go-mr-1",type:I.dataPondId===w.value?"warning":"",bordered:!1},{default:t(()=>[h(" 地址 ")]),_:2},1032,["type"]),e(b,{style:{"max-width":"180px"}},{default:t(()=>[h(F(I.dataPondRequestConfig.requestUrl||"暂无"),1)]),_:2},1024)])]),_("div",{class:"item-content-icon go-transition-quick",onClick:H=>P(H,I)},[e(z,null,{default:t(()=>[e(a(R))]),_:1})],8,We)]),_("div",{class:re({"select-modal":I.dataPondId===w.value})},null,2)],10,Ve))),128))]),_:1})])])}}});const Xe=V(Qe,[["__scopeId","data-v-57909643"]]),Ze=_("thead",null,[_("tr",null,[_("th",null,"key"),_("th",null,"value")])],-1),ie=L({__name:"displayTable",props:{target:Object},setup(o){const r=o,d={key:"",value:""},v=Pe({content:[]});return Z(()=>r.target,R=>{v.content=[];for(const q in R)v.content.push({key:q,value:R[q]});v.content.length||(v.content=[JSON.parse(JSON.stringify(d))])},{immediate:!0,deep:!0}),(R,q)=>{const p=n("n-table");return c(),N(p,{bordered:!1,"single-line":!1,size:"small",style:{"border-bottom-right-radius":"7px","border-bottom-left-radius":"7px"}},{default:t(()=>[Ze,_("tbody",null,[(c(!0),$(Y,null,ne(v.content,(m,u)=>(c(),$("tr",{key:u},[_("td",null,F(m.key||"暂无"),1),_("td",null,F(m.value||"暂无"),1)]))),128))])]),_:1})}}}),Ke={class:"go-chart-data-display"},et={class:"go-mr-3"},tt={key:0},at={class:"go-mt-3"},nt={key:0},ot={key:1},st={key:1},lt=L({__name:"index",props:{globalData:Object,targetData:Object},setup(o){const r=o,{HelpOutlineIcon:d,FlashIcon:v,PulseIcon:R}=te.ionicons5,{requestUrl:q,requestInterval:p,requestHttpType:m,requestContentType:u,requestSQLContent:w,requestParams:x,requestParamsBodyType:l,requestIntervalUnit:P}=ee(r.targetData.dataPondRequestConfig);A.HEADER;const D={[X.DEFAULT]:"普通请求",[X.SQL]:"SQL 请求"},y=T(A.PARAMS);return(U,E)=>{const C=n("n-input"),z=n("n-icon"),S=n("n-divider"),k=n("n-tab"),f=n("n-tabs"),O=n("n-text"),s=n("n-card"),i=n("n-code"),b=n("n-scrollbar");return c(),$("div",Ke,[e(b,{style:{"max-height":"570px"}},{default:t(()=>[_("div",et,[_("div",null,[e(a(B),{name:"主体信息"},{default:t(()=>[e(a(j),{name:"接口名称"},{default:t(()=>{var g;return[e(C,{size:"small",placeholder:((g=o.targetData)==null?void 0:g.dataPondName)||"暂无",disabled:!0},null,8,["placeholder"])]}),_:1}),e(a(j),{name:"接口类型"},{default:t(()=>[e(C,{size:"small",placeholder:a(m)||"暂无",disabled:!0},null,8,["placeholder"])]),_:1})]),_:1}),e(a(B),null,{default:t(()=>[e(a(j),{name:"组件间隔"},{default:t(()=>[e(C,{size:"small",placeholder:`${a(p)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(F(o.targetData&&a(ce)[a(P)]),1)]),_:1},8,["placeholder"])]),_:1}),e(a(j),{name:"全局间隔（默认）"},{default:t(()=>{var g;return[e(C,{size:"small",placeholder:`${((g=o.globalData)==null?void 0:g.requestInterval)||"暂无"}`,disabled:!0},{suffix:t(()=>[h(F(o.globalData&&a(ce)[o.globalData.requestIntervalUnit]),1)]),_:1},8,["placeholder"])]}),_:1})]),_:1}),e(a(B),{name:"源地址",alone:!0},{default:t(()=>{var g;return[e(C,{size:"small",placeholder:((g=o.globalData)==null?void 0:g.requestOriginUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(z,{component:a(R)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(B),{name:"接口地址",alone:!0},{default:t(()=>[e(C,{size:"small",placeholder:a(q)||"暂无",disabled:!0},{prefix:t(()=>[e(z,{component:a(v)},null,8,["component"])]),_:1},8,["placeholder"])]),_:1})]),e(S),e(a(B),{name:"类型"},{default:t(()=>[e(a(j),{name:"配置类型"},{default:t(()=>[e(C,{size:"small",placeholder:o.targetData&&D[a(u)],disabled:!0},null,8,["placeholder"])]),_:1}),a(u)===a(X).DEFAULT?(c(),N(a(j),{key:0,name:"body 类型"},{default:t(()=>[e(C,{size:"small",placeholder:o.targetData&&a(l),disabled:!0},null,8,["placeholder"])]),_:1})):ae("",!0)]),_:1}),a(u)===a(X).DEFAULT?(c(),$("div",tt,[e(f,{type:"line",animated:"",value:y.value,"onUpdate:value":E[0]||(E[0]=g=>y.value=g)},{default:t(()=>[(c(!0),$(Y,null,ne(a(A),g=>(c(),N(k,{key:g,name:g,tab:g},{default:t(()=>[h(F(g),1)]),_:2},1032,["name","tab"]))),128))]),_:1},8,["value"]),_("div",at,[y.value!==a(A).BODY?(c(),$("div",nt,[e(ie,{class:"go-my-3",target:a(x)[y.value]},null,8,["target"])])):(c(),$("div",ot,[a(l)===a(M).NONE?(c(),N(s,{key:0,class:"go-mt-3 go-pb-3"},{default:t(()=>[e(O,{depth:"3"},{default:t(()=>[h("该接口没有 Body 体")]),_:1})]),_:1})):a(l)===a(M).FORM_DATA||a(l)===a(M).X_WWW_FORM_URLENCODED?(c(),N(ie,{key:1,class:"go-my-3",target:a(x)[a(A).BODY][a(l)]},null,8,["target"])):a(l)===a(M).JSON?(c(),N(s,{key:2,size:"small",style:{"padding-bottom":"7px"}},{default:t(()=>[e(i,{code:a(x)[a(A).BODY][a(l)]||"暂无内容",language:"json"},null,8,["code"])]),_:1})):a(l)===a(M).XML?(c(),N(i,{key:3,code:a(x)[a(A).BODY][a(l)]||"",language:"html"},null,8,["code"])):ae("",!0)]))])])):(c(),$("div",st,[e(a(B),{name:"键名"},{default:t(()=>[e(O,null,{default:t(()=>[h("sql")]),_:1})]),_:1}),e(a(B),{name:"键值"},{default:t(()=>[e(i,{code:a(w).sql||"",language:"sql"},null,8,["code"])]),_:1})]))])]),_:1})])}}});const dt=V(lt,[["__scopeId","data-v-a7a3ca3e"]]),rt={class:"pond-content"},ct={key:1,class:"no-data go-flex-center"},ut=["src"],it=L({__name:"index",props:{modelShow:Boolean},emits:["update:modelShow","sendHandle"],setup(o,{emit:r}){const d=o,v=r,{PencilIcon:R}=te.ionicons5,{chartEditStore:q,targetData:p}=oe(),{requestDataPond:m}=ee(q.getRequestGlobalConfig),u=T(!1),w=T(!1),x=T(!1),l=T(!1),P=T(),D=G(()=>{var b,g;const s=(g=(b=p==null?void 0:p.value)==null?void 0:b.request)==null?void 0:g.requestDataPondId;return s?m.value.filter(I=>s===I.dataPondId)[0]:void 0});Z(()=>d.modelShow,s=>{w.value=s}),Z(()=>D.value,s=>{x.value=!0,P.value=s,De(()=>{x.value=!1})},{immediate:!0});const y=(s=!1)=>{l.value=!!s,u.value=!0},U=()=>{const s=Ie();P.value={dataPondId:s,dataPondName:s,dataPondRequestConfig:Ce.cloneDeep(Q(W({},Ee),{requestDataType:ue.Pond}))},y()},E=s=>{l.value?C(s):z(s),l.value=!1,u.value=!1},C=s=>{try{const i=m.value.findIndex(b=>b.dataPondId===s.dataPondId);i!==-1?(m.value.splice(i,1,s),q.getComponentList.forEach(b=>{b.request.requestDataType===ue.Pond&&b.request.requestDataPondId===s.dataPondId&&(b.request=Q(W({},K(s.dataPondRequestConfig)),{requestDataPondId:s.dataPondId}))}),window.$message.success("保存成功！")):window.$message.error("编辑失败，请稍后重试！")}catch(i){window.$message.error("编辑失败，请稍后重试！")}},z=s=>{try{P.value?(m.value.unshift(s),window.$message.success("创建成功!")):window.$message.error("创建失败，请稍后重试!")}catch(i){window.$message.error("创建失败，请稍后重试!")}},S=s=>{me({message:"删除数据后，需手动处理使用改接口的组件，是否继续？",isMaskClosable:!0,transformOrigin:"center",onPositiveCallback:()=>{const i=m.value.findIndex(b=>b.dataPondId===s.dataPondId);i!==-1?(m.value.splice(i,1),window.$message.success("删除成功!")):window.$message.error("删除失败，请稍后重试！")}})},k=()=>{D.value&&(p.value.request=Q(W({},K(D.value.dataPondRequestConfig)),{requestDataPondId:D.value.dataPondId})),v("update:modelShow",!1),v("sendHandle")},f=()=>{v("update:modelShow",!1)},O=()=>{f()};return(s,i)=>{const b=n("n-text"),g=n("n-icon"),I=n("n-button"),H=n("n-space"),fe=n("n-card"),ge=n("n-modal");return c(),$(Y,null,[e(ge,{class:"go-chart-data-pond-control",show:w.value,"onUpdate:show":i[1]||(i[1]=J=>w.value=J),"mask-closable":!1,"close-on-esc":!0,onEsc:O},{default:t(()=>[e(fe,{bordered:!1,role:"dialog",size:"small","aria-modal":"true",style:{width:"900px",height:"650px"}},{header:t(()=>[]),"header-extra":t(()=>[]),action:t(()=>[e(H,{justify:"space-between"},{default:t(()=>[e(I,{type:"info",secondary:"",disabled:!D.value,onClick:i[0]||(i[0]=J=>y(!0))},{icon:t(()=>[e(g,null,{default:t(()=>[e(a(R))]),_:1})]),default:t(()=>[h(" 编辑内容 ")]),_:1},8,["disabled"]),_("div",null,[e(I,{class:"go-mr-3",onClick:f},{default:t(()=>[h("取消")]),_:1}),e(I,{type:"primary",onClick:k},{default:t(()=>[h("保存 & 发送请求")]),_:1})])]),_:1})]),default:t(()=>[_("div",rt,[D.value&&!x.value?(c(),N(a(dt),{key:0,targetData:D.value,globalData:a(q).getRequestGlobalConfig},null,8,["targetData","globalData"])):(c(),$("div",ct,[_("img",{src:a(Oe),alt:"暂无数据"},null,8,ut),e(b,{depth:3},{default:t(()=>[h("暂未选择公共接口")]),_:1})])),e(a(Xe),{onCreatePond:U,onDeletePond:S})])]),_:1})]),_:1},8,["show"]),e(a(Fe),{modelShow:u.value,"onUpdate:modelShow":i[2]||(i[2]=J=>u.value=J),targetDataRequest:P.value,isEdit:l.value,onEditSaveHandle:E},null,8,["modelShow","targetDataRequest","isEdit"])],64)}}});const _t=V(it,[["__scopeId","data-v-2f6e25f2"]]),pt={class:"go-chart-data-pond"},mt={class:"go-absolute-center"},ft=L({__name:"index",setup(o){_e(k=>({de86fbd4:C.value}));const r=pe(),{HelpOutlineIcon:d,FlashIcon:v,PulseIcon:R,FishIcon:q}=te.ionicons5,{targetData:p,chartEditStore:m}=oe(),{requestDataPond:u,requestInterval:w,requestIntervalUnit:x}=ee(m.getRequestGlobalConfig),l=T(!1),P=T(!1),D=T(!1);let y=0,U;const E=G(()=>{const k=p.value.request.requestDataPondId;return k?u.value.filter(O=>k===O.dataPondId)[0]:void 0}),C=G(()=>r.getAppTheme),z=()=>{P.value=!0},S=()=>de(this,null,function*(){var k;if(!((k=p.value)!=null&&k.request)){window.$message.warning("请选择一个公共接口！");return}l.value=!0;try{const f=yield Re(K(p.value.request),K(m.getRequestGlobalConfig));if(l.value=!1,f){if(!(f!=null&&f.data)&&!p.value.filter){window.$message.warning("您的数据不符合默认格式，请配置过滤器！"),D.value=!0;return}p.value.option.dataset=$e(f==null?void 0:f.data,f,p.value.filter),D.value=!0;return}window.$message.warning("没有拿到返回值，请检查接口！")}catch(f){console.error(f),l.value=!1,window.$message.warning("数据异常，请检查参数！")}});return Se(()=>{var f;const k=(f=p.value)==null?void 0:f.filter;U!==k&&y&&(U=k,S()),y++}),ke(()=>{U=null}),(k,f)=>{const O=n("n-icon"),s=n("n-input"),i=n("n-button"),b=n("n-card"),g=n("n-tooltip"),I=n("go-skeleton");return c(),$(Y,null,[_("div",pt,[e(b,{class:"n-card-shallow"},{default:t(()=>[e(a(B),{name:"请求名称",alone:!0},{default:t(()=>{var H;return[e(s,{size:"small",placeholder:((H=E.value)==null?void 0:H.dataPondName)||"暂无",disabled:!0},{prefix:t(()=>[e(O,{component:a(q)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),e(a(B),{name:"接口地址",alone:!0},{default:t(()=>{var H;return[e(s,{size:"small",placeholder:((H=E.value)==null?void 0:H.dataPondRequestConfig.requestUrl)||"暂无",disabled:!0},{prefix:t(()=>[e(O,{component:a(v)},null,8,["component"])]),_:1},8,["placeholder"])]}),_:1}),_("div",{class:"edit-text",onClick:z},[_("div",mt,[e(i,{type:"primary",secondary:""},{default:t(()=>[h("编辑配置")]),_:1})])])]),_:1})]),e(a(B),{alone:!0},{name:t(()=>[h(" 测试 "),e(g,{trigger:"hover"},{trigger:t(()=>[e(O,{size:"21",depth:3},{default:t(()=>[e(a(d))]),_:1})]),default:t(()=>[h(" 默认赋值给 dataset 字段 ")]),_:1})]),default:t(()=>[e(i,{type:"primary",ghost:"",onClick:S},{icon:t(()=>[e(O,null,{default:t(()=>[e(a(v))]),_:1})]),default:t(()=>[h(" 发送请求 ")]),_:1})]),_:1}),e(a(ze),{show:D.value&&!l.value,ajax:!0},null,8,["show"]),e(I,{load:l.value,repeat:3},null,8,["load"]),e(a(_t),{modelShow:P.value,"onUpdate:modelShow":f[0]||(f[0]=H=>P.value=H),onSendHandle:S},null,8,["modelShow"])],64)}}});const Ft=V(ft,[["__scopeId","data-v-12a5488e"]]);export{Ft as default};
