var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var G=(a,c,o)=>c in a?ee(a,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[c]=o,B=(a,c)=>{for(var o in c||(c={}))ne.call(c,o)&&G(a,o,c[o]);if(q)for(var o of q(c))oe.call(c,o)&&G(a,o,c[o]);return a},L=(a,c)=>te(a,ae(c));var E=(a,c,o)=>new Promise((l,p)=>{var m=u=>{try{d(o.next(u))}catch(k){p(k)}},h=u=>{try{d(o.throw(u))}catch(k){p(k)}},d=u=>u.done?l(u.value):Promise.resolve(u.value).then(m,h);d((o=o.apply(a,c)).next())});import{d as se,E as X,G as R,a as V,I as le,W as ce,j as i,k as f,c as z,e as n,w as s,b as T,n as S,t as N,F,l as O,C,D as J,f as M,a6 as ie,a7 as re,z as Y,o as de,Q,U as W,aa as K,J as pe,R as me,L as ue,M as _e,N as fe}from"./index-9e787fa5.js";import{i as ge}from"./icon-caec1666.js";import{p as ye,c as he,s as ve,f as be}from"./project-c1868b8d.js";const Te={key:0,class:"go-items-list-card"},ke={class:"list-content"},we={class:"list-content-top"},xe={class:"go-flex-items-center list-footer",justify:"space-between"},De={class:"go-flex-items-center list-footer-ri"},Ie=se({__name:"index",props:{cardData:Object},emits:["preview","delete","resize","edit","release"],setup(a,{emit:c}){const o=X(),l="http://127.0.0.1:8083",{HammerIcon:p}=ge.ionicons5,m=c,h=R(()=>o.templateTypeMapping),d=a,u=V([{label:le("global.r_edit"),key:"edit",icon:ce(p)}]),k=g=>{switch(g){case"preview":$();break;case"delete":e();break;case"release":w();break;case"edit":t();break}},U=(g="")=>g==""?"":o.getTemplateTypeInfo(g).label||"",$=()=>{m("preview",d.cardData)},e=()=>{m("delete",d.cardData)},t=()=>{m("edit",d.cardData)},w=()=>{m("release",d.cardData)},v=()=>{m("resize",d.cardData)};return(g,I)=>{const _=i("n-text"),b=i("n-image"),D=i("n-button"),x=i("n-tooltip"),j=i("n-space"),P=i("n-card");return a.cardData?(f(),z("div",Te,[n(P,{hoverable:"",size:"small"},{action:s(()=>[T("div",xe,[n(_,{class:"go-ellipsis-1"},{default:s(()=>[S(N(a.cardData.templateName||a.cardData.id||"未命名"),1)]),_:1}),T("div",De,[n(j,null,{default:s(()=>[n(_,null,{default:s(()=>[S(N(a.cardData.userName||"作者"),1)]),_:1}),(f(!0),z(F,null,O(u,y=>(f(),C(x,{key:y.key,placement:"bottom",trigger:"hover"},{trigger:s(()=>[n(D,{size:"small",onClick:H=>k(y.key)},{icon:s(()=>[(f(),C(J(y.icon)))]),_:2},1032,["onClick"])]),default:s(()=>[(f(),C(J(y.label)))]),_:2},1024))),128))]),_:1})])])]),default:s(()=>[T("div",ke,[T("div",we,[n(_,null,{default:s(()=>{var y,H;return[S(N(h.value[(y=a.cardData)==null?void 0:y.templateType])+"类型-"+N(U((H=a.cardData)==null?void 0:H.typeId)),1)]}),_:1})]),T("div",{class:"list-content-img",onClick:v},[n(b,{"object-fit":"contain",height:"180","preview-disabled":"",src:`${M(l)}/${a.cardData.indexImage}?time=${new Date().getTime()}`,alt:a.cardData.templateName,"fallback-src":M(ie)()},null,8,["src","alt","fallback-src"])])])]),_:1})])):re("",!0)}}});const Pe=Y(Ie,[["__scopeId","data-v-928ceaaf"]]);const He={class:"go-project-comprehensive-template"},ze={class:"list-pagination"},Ce={__name:"index",setup(a){const c=X(),o=R(()=>c.template_type_list_synthesis||[]),l=V({loading:!0,searchParam:{name:null,startTime:null,endTime:null,typeId:null,templateType:"synthesis",state:1},tableData:[]}),p=V({page:1,limit:12,count:10});let m=R({get(){let{startTime:e,endTime:t}=l.searchParam;return!e&&!t?null:[e,t]},set(e){l.searchParam.startTime=(e==null?void 0:e[0])||null,l.searchParam.endTime=(e==null?void 0:e[1])||null}}),h=R({get(){return[l.searchParam.typeId]},set(e){l.searchParam.typeId=e[e.length-1]||null}});de(()=>{d()});const d=()=>E(this,null,function*(){l.loading=!0;let e=L(B({},l.searchParam),{page:p.page,limit:p.limit});try{const t=yield ye(e);if((t==null?void 0:t.code)==200){const{count:w}=t;p.count=w,l.tableData=t.data.map(v=>L(B({},v),{release:v.state!==-1}))}setTimeout(()=>{l.loading=!1},500)}catch(t){l.loading=!1}}),u=e=>E(this,null,function*(){if(!e)return;let t=yield k(e==null?void 0:e.id);if(!t)return;let{indexImage:w,templateType:v,typeId:g,content:I}=t;try{let _={templateName:pe(),typeId:g,templateType:v,indexImage:w};const b=yield he(_);if(b&&b.code===me.SUCCESS){const{id:D}=b.data;let x=new FormData;x.append("templateId",D),x.append("content",I);const j=yield ve(x),P=ue(_e.CHART_HOME_NAME,"href");fe(P,[D],void 0,!0)}}catch(_){window.$message.error(window.$t("project.create_failure"))}}),k=(e="")=>E(this,null,function*(){const t=yield be({templateId:e});return(t==null?void 0:t.data)||null}),U=e=>{p.page=e,d()},$=e=>{p.limit=e,d()};return(e,t)=>{const w=i("go-loading"),v=i("n-checkbox"),g=i("n-space"),I=i("n-checkbox-group"),_=i("n-form-item"),b=i("n-form"),D=i("n-input"),x=i("n-date-picker"),j=i("n-button"),P=i("n-grid-item"),y=i("n-grid"),H=i("n-pagination");return f(),z("div",He,[Q(T("div",null,[n(w)],512),[[W,l.loading]]),Q(T("div",null,[n(b,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:s(()=>[n(_,{label:"综合类型"},{default:s(()=>[n(I,{value:M(h),"onUpdate:value":t[0]||(t[0]=r=>K(h)?h.value=r:h=r)},{default:s(()=>[n(g,{"item-style":"display: flex;"},{default:s(()=>[(f(!0),z(F,null,O(o.value,(r,A)=>(f(),C(v,{value:r.id,label:r.label,key:A},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},512),n(b,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:s(()=>[n(_,{label:"模板名称"},{default:s(()=>[n(D,{placeholder:"输入模板名称",value:l.searchParam.name,"onUpdate:value":t[1]||(t[1]=r=>l.searchParam.name=r),clearable:""},null,8,["value"])]),_:1}),n(_,{label:"创建时间"},{default:s(()=>[n(x,{"formatted-value":M(m),"onUpdate:formattedValue":t[2]||(t[2]=r=>K(m)?m.value=r:m=r),"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",clearable:""},null,8,["formatted-value"])]),_:1}),n(_,null,{default:s(()=>[n(j,{ghost:"",onClick:d},{default:s(()=>[S("筛选")]),_:1})]),_:1})]),_:1},512),n(y,{"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:4 xl:4 xxl:4",responsive:"screen"},{default:s(()=>[(f(!0),z(F,null,O(l.tableData,(r,A)=>(f(),C(P,{key:r.id},{default:s(()=>[n(Pe,{cardData:r,onPreview:e.previewHandle,onResize:e.resizeHandle,onDelete:Z=>e.deleteHandle(r),onRelease:Z=>e.releaseHandle(r,A),onEdit:u},null,8,["cardData","onPreview","onResize","onDelete","onRelease"])]),_:2},1024))),128))]),_:1})],512),[[W,!l.loading]]),T("div",ze,[n(H,{page:p.page,"page-size":p.limit,"item-count":p.count,"page-sizes":[12,24,36,48],"onUpdate:page":U,"onUpdate:pageSize":$,"show-size-picker":""},null,8,["page","page-size","item-count"])])])}}},Se=Y(Ce,[["__scopeId","data-v-f6f1135a"]]);export{Se as default};
