var ue=Object.defineProperty,me=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var J=Object.getOwnPropertySymbols;var ye=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var K=(l,i,s)=>i in l?ue(l,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[i]=s,B=(l,i)=>{for(var s in i||(i={}))ye.call(i,s)&&K(l,s,i[s]);if(J)for(var s of J(i))fe.call(i,s)&&K(l,s,i[s]);return l},E=(l,i)=>me(l,_e(i));var $=(l,i,s)=>new Promise((o,u)=>{var c=y=>{try{x(s.next(y))}catch(I){u(I)}},_=y=>{try{x(s.throw(y))}catch(I){u(I)}},x=y=>y.done?o(y.value):Promise.resolve(y.value).then(c,_);x((s=s.apply(l,i)).next())});import{d as ge,E as ae,G as M,a as L,I as X,W as Y,j as r,k as w,c as V,e as t,w as n,b as v,n as F,t as G,F as ne,l as oe,C,D as Z,f as b,a6 as he,a7 as Q,z as le,o as se,af as W,aj as be,ak as q,aa as ie,ad as ke,al as we,V as P,am as j,an as ve,a8 as xe,a9 as Ie,ao as Te,Q as ee,U as te}from"./index-9e787fa5.js";import{i as ce}from"./icon-caec1666.js";import{f as De}from"./project-c1868b8d.js";import{p as Pe,a as Ce,b as Ne,u as ze}from"./product-f2aefb19.js";const Se={key:0,class:"go-items-list-card"},$e={class:"list-content"},He={class:"list-content-top"},Ue={class:"list-content-img"},je={class:"go-flex-items-center list-footer",justify:"space-between"},Le={class:"go-flex-items-center list-footer-ri"},Re=ge({__name:"index",props:{cardData:Object},emits:["update","directory"],setup(l,{emit:i}){const s=ae(),o="http://127.0.0.1:8083",{EllipsisHorizontalCircleSharpIcon:u,CopyIcon:c,TrashIcon:_,PencilIcon:x,DownloadIcon:y,BrowsersOutlineIcon:I,HammerIcon:R,SendIcon:f,DocumentTextIcon:g,AnalyticsIcon:m}=ce.ionicons5,T=i,k=M(()=>s.templateTypeMapping),H=(p="")=>p==""?"":s.getTemplateTypeInfo(p).label||"",e=l,a=L([{label:X("global.r_directory"),key:"directory",icon:Y(g)},{label:X("global.r_update"),key:"update",icon:Y(m)}]),h=p=>{switch(p){case"directory":d();break;case"update":U();break}},d=()=>{T("directory",e.cardData)},U=()=>{T("update",e.cardData)};return(p,A)=>{const N=r("n-text"),z=r("n-image"),S=r("n-button"),re=r("n-tooltip"),de=r("n-space"),pe=r("n-card");return l.cardData?(w(),V("div",Se,[t(pe,{hoverable:"",size:"small"},{action:n(()=>[v("div",je,[t(N,{class:"go-ellipsis-1"},{default:n(()=>[F(G(l.cardData.templateName||l.cardData.id||"未命名"),1)]),_:1}),v("div",Le,[t(de,null,{default:n(()=>[(w(!0),V(ne,null,oe(a,D=>(w(),C(re,{key:D.key,placement:"bottom",trigger:"hover"},{trigger:n(()=>[t(S,{size:"small",onClick:O=>h(D.key)},{icon:n(()=>[(w(),C(Z(D.icon)))]),_:2},1032,["onClick"])]),default:n(()=>[(w(),C(Z(D.label)))]),_:2},1024))),128))]),_:1})])])]),default:n(()=>[v("div",$e,[v("div",He,[t(N,null,{default:n(()=>{var D,O;return[F(G(k.value[(D=l.cardData)==null?void 0:D.templateType])+"类型-"+G(H((O=l.cardData)==null?void 0:O.typeId)),1)]}),_:1})]),v("div",Ue,[t(z,{"object-fit":"contain",height:"180","preview-disabled":"",src:`${b(o)}/${l.cardData.indexImage}`,alt:l.cardData.taskName,"fallback-src":b(he)()},null,8,["src","alt","fallback-src"])])])]),_:1})])):Q("",!0)}}});const Ae=le(Re,[["__scopeId","data-v-83e278dc"]]);const Be={class:"list-pagination"},Ee={__name:"index",props:{show:{type:Boolean,default:()=>!1},info:{type:Object,default:()=>{}}},emits:["update:show"],setup(l,{emit:i}){const{CloseIcon:s}=ce.ionicons5,o=i,u=l,c=L({loading:!0,cycleList:[{label:"年",value:"year"},{label:"月",value:"month"},{label:"周",value:"week"},{label:"日",value:"day"},{label:"时",value:"hour"}],tableData:[],searchParam:{startTime:null,endTime:null,periodRange:null,period:null}}),_=L({page:1,limit:12,count:10}),x={year:"年",month:"月",week:"周",day:"日",hour:"时"};se(()=>{k()});let y=M({get(){let{startTime:e,endTime:a}=c.searchParam;return!e&&!a?null:[e,a]},set(e){c.searchParam.startTime=(e==null?void 0:e[0])||null,c.searchParam.endTime=(e==null?void 0:e[1])||null}});const I=e=>{_.page=e,k()},R=e=>{_.limit=e,k()},f=()=>{o("update:show",!1)},g=e=>{xe(Ie(e.templateId))},m=e=>$(this,null,function*(){try{let{code:a,data:h}=yield De({templateId:e.templateId});a==200&&Te(h.content,`${e.taskName}-${e.createTime}`,"json")}catch(a){window.$message.error("导出失败")}}),T=(()=>[{type:"expand",renderExpand:e=>P(ve,{column:1,bordered:!0,labelPlacement:"left"},{default:()=>[P(j,{label:"名称"},{default:()=>e.taskName||"未命名"}),P(j,{label:"基于"},{default:()=>e.templateName||"未命名"}),P(j,{label:"周期"},{default:()=>`${e.period}${x[e.periodRange]}/次`}),P(j,{label:"时间"},{default:()=>e.createTime}),P(j,{label:"功能描述"},{default:()=>e.description||"暂无"})]})},{title:"任务",key:"id"},{title:"模板",key:"templateName"},{title:"创建时间",key:"createTime"},{title:"操作",key:"actions",width:200,render(e){let a=[{title:"可视化",type:"info",key:"visual",onClick:d=>{g(d)}},{title:"导出",type:"warning",key:"export",onClick:d=>{m(d)}}];return e.state==-1&&a.push({title:"发布",type:"success",key:"publish",onClick:d=>{H(d)}}),a.map(d=>P(W,{size:"small",type:d.type,key:d.key,tertiary:!0,text:!0,style:{marginRight:"12px"},onClick:()=>d.onClick(e)},{default:()=>d.title}))}}])(),k=()=>$(this,null,function*(){let e=E(B({},c.searchParam),{templateId:u.info.id,page:_.page,limit:_.limit});try{const a=yield Pe(e);if((a==null?void 0:a.code)==200){c.tableData=a.data.map(d=>E(B({},d),{templateName:u.info.templateName,key:d.id}));const{count:h}=a;_.count=h}setTimeout(()=>{c.loading=!1},500)}catch(a){c.loading=!1}}),H=e=>$(this,null,function*(){let a={id:e.id,state:1};try{const h=yield Ce(a);(h==null?void 0:h.code)===200&&(window.$message.success("发布成功"),k())}catch(h){}});return(e,a)=>{const h=r("n-date-picker"),d=r("n-spin"),U=r("n-space"),p=r("n-pagination"),A=r("n-card"),N=r("n-modal");return w(),C(N,{show:u.show,"onUpdate:show":a[2]||(a[2]=z=>u.show=z)},{default:n(()=>{var z;return[t(A,{style:{width:"1000px"},title:`${(z=l.info)==null?void 0:z.templateName}-目录`,bordered:!1,size:"huge",role:"dialog","aria-modal":"true"},{"header-extra":n(()=>[t(b(W),{size:"small",text:"",onClick:f},{icon:n(()=>[t(b(s))]),_:1})]),footer:n(()=>[v("div",Be,[t(p,{page:_.page,"page-size":_.limit,"item-count":_.count,"page-sizes":[12,24,36,48],"onUpdate:page":I,"onUpdate:pageSize":R,"show-size-picker":""},null,8,["page","page-size","item-count"])])]),default:n(()=>[t(b(be),{ref:"formRef",class:"formTitle",inline:"","label-placement":"left","label-width":"auto"},{default:n(()=>[t(b(q),{label:"时间范围"},{default:n(()=>[t(h,{"formatted-value":b(y),"onUpdate:formattedValue":a[0]||(a[0]=S=>ie(y)?y.value=S:y=S),"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",clearable:""},null,8,["formatted-value"])]),_:1}),t(b(q),{label:"任务周期"},{default:n(()=>[t(b(ke),{value:c.searchParam.periodRange,"onUpdate:value":a[1]||(a[1]=S=>c.searchParam.periodRange=S),options:c.cycleList,style:{width:"250px"}},null,8,["value","options"])]),_:1}),t(b(q),null,{default:n(()=>[t(b(W),{ghost:"",onClick:k},{default:n(()=>[F(" 筛选 ")]),_:1})]),_:1})]),_:1},512),t(U,{vertical:""},{default:n(()=>[t(d,{show:c.loading},{default:n(()=>[c.loading?Q("",!0):(w(),C(b(we),{key:0,columns:b(T),data:c.tableData},null,8,["columns","data"]))]),_:1},8,["show"])]),_:1})]),_:1},8,["title"])]}),_:1},8,["show"])}}};const Me={class:"go-project-statistical-productList-template"},Ve={class:"list-pagination"},Fe={__name:"index",setup(l){const i=ae(),s=M(()=>[{type:"group",label:"基础类型",key:"group1",children:i.template_type_list_synthesis},{type:"group",label:"综合类型",key:"group2",children:i.template_type_list_basic}]),o=L({currDirectory:{},directoryPanelShow:!1,loading:!0,tableData:[],searchParam:{name:null,typeId:null,templateType:null},addModelShow:!1}),u=L({page:1,limit:12,count:10});let c=M({get(){return o.searchParam.typeId},set(f){o.searchParam.typeId=Object.values(f)||[]}});se(()=>{_()});const _=()=>$(this,null,function*(){var g;o.loading=!0;let f=E(B({},o.searchParam),{typeId:(g=o.searchParam.typeId)==null?void 0:g.join(","),page:u.page,limit:u.limit});try{const m=yield Ne(f);if((m==null?void 0:m.code)==200){const{count:T}=m;u.count=T,o.tableData=m.data}setTimeout(()=>{o.loading=!1},500)}catch(m){o.loading=!1}}),x=f=>{u.page=f,_()},y=f=>{u.limit=f,_()},I=f=>{o.currDirectory=f,o.directoryPanelShow=!0},R=f=>$(this,null,function*(){let g={templateId:f.id};try{const m=yield ze(g);(m==null?void 0:m.code)==200&&window.$message.success("更新成功")}catch(m){}});return(f,g)=>{const m=r("go-loading"),T=r("n-input"),k=r("n-form-item"),H=r("n-select"),e=r("n-button"),a=r("n-form"),h=r("n-grid-item"),d=r("n-grid"),U=r("n-pagination");return w(),V("div",Me,[ee(v("div",null,[t(m)],512),[[te,o.loading]]),ee(v("div",null,[t(a,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:n(()=>[t(k,{label:"产品名称"},{default:n(()=>[t(T,{placeholder:"请输入",value:o.searchParam.name,"onUpdate:value":g[0]||(g[0]=p=>o.searchParam.name=p)},null,8,["value"])]),_:1}),t(k,{label:"类型"},{default:n(()=>[t(H,{filterable:"",value:b(c),"onUpdate:value":g[1]||(g[1]=p=>ie(c)?c.value=p:c=p),options:s.value,"value-field":"id",multiple:"",style:{width:"240px"},"max-tag-count":1},null,8,["value","options"])]),_:1}),t(k,null,{default:n(()=>[t(e,{ghost:"",onClick:_},{default:n(()=>[F(" 筛选 ")]),_:1})]),_:1})]),_:1},512),t(d,{"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:4 xl:4 xxl:4",responsive:"screen"},{default:n(()=>[(w(!0),V(ne,null,oe(o.tableData,(p,A)=>(w(),C(h,{key:p.id},{default:n(()=>[t(Ae,{cardData:p,onDirectory:N=>I(p),onUpdate:N=>R(p)},null,8,["cardData","onDirectory","onUpdate"])]),_:2},1024))),128))]),_:1})],512),[[te,!o.loading]]),v("div",Ve,[t(U,{page:u.page,"page-size":u.limit,"item-count":u.count,"page-sizes":[12,24,36,48],"onUpdate:page":x,"onUpdate:pageSize":y,"show-size-picker":""},null,8,["page","page-size","item-count"])]),o.directoryPanelShow?(w(),C(Ee,{key:0,show:o.directoryPanelShow,"onUpdate:show":g[2]||(g[2]=p=>o.directoryPanelShow=p),info:o.currDirectory},null,8,["show","info"])):Q("",!0)])}}},Je=le(Fe,[["__scopeId","data-v-58009f56"]]);export{Je as default};
