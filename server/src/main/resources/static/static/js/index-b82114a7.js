var oe=Object.defineProperty,le=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var ce=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var W=(a,c,o)=>c in a?oe(a,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[c]=o,V=(a,c)=>{for(var o in c||(c={}))ce.call(c,o)&&W(a,o,c[o]);if(Q)for(var o of Q(c))re.call(c,o)&&W(a,o,c[o]);return a},F=(a,c)=>le(a,se(c));var E=(a,c,o)=>new Promise((s,d)=>{var v=m=>{try{_(o.next(m))}catch(k){d(k)}},I=m=>{try{_(o.throw(m))}catch(k){d(k)}},_=m=>m.done?s(m.value):Promise.resolve(m.value).then(v,I);_((o=o.apply(a,c)).next())});import{d as ie,E as ee,G as R,a as O,I as de,W as pe,j as r,k as u,c as z,e as n,w as l,b as h,n as M,t as N,F as q,l as G,C as S,D as K,f as U,a6 as me,a7 as ue,z as te,o as _e,Q as X,U as Y,aa as Z,J as fe,R as ge,L as ye,M as be,N as he}from"./index-9e787fa5.js";import{i as ve}from"./icon-caec1666.js";import{p as Ie,c as we,s as Te,f as ke}from"./project-c1868b8d.js";const xe={key:0,class:"go-items-list-card"},De={class:"list-content"},Pe={class:"list-content-top"},He={class:"go-flex-items-center list-footer",justify:"space-between"},Ce={class:"go-flex-items-center list-footer-ri"},ze=ie({__name:"index",props:{cardData:Object},emits:["preview","delete","resize","edit","release"],setup(a,{emit:c}){const o=ee(),s="http://127.0.0.1:8083",{EllipsisHorizontalCircleSharpIcon:d,CopyIcon:v,TrashIcon:I,PencilIcon:_,DownloadIcon:m,BrowsersOutlineIcon:k,HammerIcon:$,SendIcon:J}=ve.ionicons5,e=R(()=>o.templateTypeMapping),t=c,p=a,y=O([{label:de("global.r_edit"),key:"edit",icon:pe($)}]),D=g=>{switch(g){case"preview":f();break;case"delete":b();break;case"release":w();break;case"edit":x();break}},P=(g="")=>g==""?"":o.getTemplateTypeInfo(g).label||"",f=()=>{t("preview",p.cardData)},b=()=>{t("delete",p.cardData)},x=()=>{t("edit",p.cardData)},w=()=>{t("release",p.cardData)},j=()=>{t("resize",p.cardData)};return(g,B)=>{const H=r("n-text"),i=r("n-image"),C=r("n-button"),A=r("n-tooltip"),ae=r("n-space"),ne=r("n-card");return a.cardData?(u(),z("div",xe,[n(ne,{hoverable:"",size:"small"},{action:l(()=>[h("div",He,[n(H,{class:"go-ellipsis-1"},{default:l(()=>[M(N(a.cardData.templateName||a.cardData.id||"未命名"),1)]),_:1}),h("div",Ce,[n(ae,null,{default:l(()=>[n(H,null,{default:l(()=>[M(N(a.cardData.userName||"作者"),1)]),_:1}),(u(!0),z(q,null,G(y,T=>(u(),S(A,{key:T.key,placement:"bottom",trigger:"hover"},{trigger:l(()=>[n(C,{size:"small",onClick:L=>D(T.key)},{icon:l(()=>[(u(),S(K(T.icon)))]),_:2},1032,["onClick"])]),default:l(()=>[(u(),S(K(T.label)))]),_:2},1024))),128))]),_:1})])])]),default:l(()=>[h("div",De,[h("div",Pe,[n(H,null,{default:l(()=>{var T,L;return[M(N(e.value[(T=a.cardData)==null?void 0:T.templateType])+"类型-"+N(P((L=a.cardData)==null?void 0:L.typeId)),1)]}),_:1})]),h("div",{class:"list-content-img",onClick:j},[n(i,{"object-fit":"contain",height:"180","preview-disabled":"",src:`${U(s)}/${a.cardData.indexImage}?time=${new Date().getTime()}`,alt:a.cardData.templateName,"fallback-src":U(me)()},null,8,["src","alt","fallback-src"])])])]),_:1})])):ue("",!0)}}});const Se=te(ze,[["__scopeId","data-v-2c503e5e"]]);const je={class:"go-project-base-template"},Ee={class:"list-pagination"},Ne={__name:"index",setup(a){const c=ee(),o=R(()=>c.template_type_list_basic||[]),s=O({loading:!0,searchParam:{name:null,startTime:null,endTime:null,typeId:null,templateType:"basic",state:1},tableData:[]}),d=O({page:1,limit:12,count:10});let v=R({get(){let{startTime:e,endTime:t}=s.searchParam;return!e&&!t?null:[e,t]},set(e){s.searchParam.startTime=(e==null?void 0:e[0])||null,s.searchParam.endTime=(e==null?void 0:e[1])||null}}),I=R({get(){return[s.searchParam.typeId]},set(e){s.searchParam.typeId=e[e.length-1]||null}});_e(()=>{_()});const _=()=>E(this,null,function*(){s.loading=!0;let e=F(V({},s.searchParam),{page:d.page,limit:d.limit});try{const t=yield Ie(e);if((t==null?void 0:t.code)==200){const{count:p}=t;d.count=p,s.tableData=t.data.map(y=>F(V({},y),{release:y.state!==-1}))}setTimeout(()=>{s.loading=!1},500)}catch(t){s.loading=!1}}),m=e=>E(this,null,function*(){if(!e)return;let t=yield k(e==null?void 0:e.id);if(!t)return;let{indexImage:p,templateType:y,typeId:D,content:P}=t;try{let f={templateName:fe(),typeId:D,templateType:y,indexImage:p};const b=yield we(f);if(b&&b.code===ge.SUCCESS){const{id:x}=b.data;let w=new FormData;w.append("templateId",x),w.append("content",P);const j=yield Te(w),g=ye(be.CHART_HOME_NAME,"href");he(g,[x],void 0,!0)}}catch(f){window.$message.error(window.$t("project.create_failure"))}}),k=(e="")=>E(this,null,function*(){const t=yield ke({templateId:e});return(t==null?void 0:t.data)||null}),$=e=>{d.page=e,_()},J=e=>{d.limit=e,_()};return(e,t)=>{const p=r("go-loading"),y=r("n-checkbox"),D=r("n-space"),P=r("n-checkbox-group"),f=r("n-form-item"),b=r("n-form"),x=r("n-input"),w=r("n-date-picker"),j=r("n-button"),g=r("n-grid-item"),B=r("n-grid"),H=r("n-pagination");return u(),z("div",je,[X(h("div",null,[n(p)],512),[[Y,s.loading]]),X(h("div",null,[n(b,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:l(()=>[n(f,{label:"基础类型"},{default:l(()=>[n(P,{value:U(I),"onUpdate:value":t[0]||(t[0]=i=>Z(I)?I.value=i:I=i)},{default:l(()=>[n(D,{"item-style":"display: flex;"},{default:l(()=>[(u(!0),z(q,null,G(o.value,(i,C)=>(u(),S(y,{value:i.id,label:i.label,key:C},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},512),n(b,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:l(()=>[n(f,{label:"模板名称"},{default:l(()=>[n(x,{placeholder:"输入模板名称",value:s.searchParam.name,"onUpdate:value":t[1]||(t[1]=i=>s.searchParam.name=i),clearable:""},null,8,["value"])]),_:1}),n(f,{label:"创建时间"},{default:l(()=>[n(w,{"formatted-value":U(v),"onUpdate:formattedValue":t[2]||(t[2]=i=>Z(v)?v.value=i:v=i),"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",clearable:""},null,8,["formatted-value"])]),_:1}),n(f,null,{default:l(()=>[n(j,{ghost:"",onClick:_},{default:l(()=>[M("筛选")]),_:1})]),_:1})]),_:1},512),n(B,{"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:4 xl:4 xxl:4",responsive:"screen"},{default:l(()=>[(u(!0),z(q,null,G(s.tableData,(i,C)=>(u(),S(g,{key:i.id},{default:l(()=>[n(Se,{cardData:i,onPreview:e.previewHandle,onResize:e.resizeHandle,onDelete:A=>e.deleteHandle(i),onRelease:A=>e.releaseHandle(i,C),onEdit:m},null,8,["cardData","onPreview","onResize","onDelete","onRelease"])]),_:2},1024))),128))]),_:1})],512),[[Y,!s.loading]]),h("div",Ee,[n(H,{page:d.page,"page-size":d.limit,"item-count":d.count,"page-sizes":[12,24,36,48],"onUpdate:page":$,"onUpdate:pageSize":J,"show-size-picker":""},null,8,["page","page-size","item-count"])])])}}},Be=te(Ne,[["__scopeId","data-v-421ccdbf"]]);export{Be as default};
