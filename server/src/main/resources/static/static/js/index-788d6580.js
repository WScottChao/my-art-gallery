var ee=Object.defineProperty,te=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,ne=Object.prototype.propertyIsEnumerable;var K=(s,t,i)=>t in s?ee(s,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):s[t]=i,H=(s,t)=>{for(var i in t||(t={}))oe.call(t,i)&&K(s,i,t[i]);if(q)for(var i of q(t))ne.call(t,i)&&K(s,i,t[i]);return s},V=(s,t)=>te(s,ae(t));var w=(s,t,i)=>new Promise((_,r)=>{var k=g=>{try{u(i.next(g))}catch(M){r(M)}},p=g=>{try{u(i.throw(g))}catch(M){r(M)}},u=g=>g.done?_(g.value):Promise.resolve(g.value).then(k,p);u((i=i.apply(s,t)).next())});import{a2 as L,a3 as $,a4 as E,a5 as U,z as B,G as P,a as R,H as se,j as f,k as C,C as A,w as d,e as n,n as N,b as I,c as G,F as le,l as re,f as h,ab as ie,d as ce,a6 as de,r as O,aa as Z,o as ue,Q as F,U as Q,a7 as pe,ac as J,ad as W,ae as me,af as j,V as x,ag as _e,ah as X,ai as fe}from"./index-9e787fa5.js";import{p as ge}from"./project-c1868b8d.js";const ye=s=>w(void 0,null,function*(){try{return yield L($.POST)(`${E.TASK}/create`,s)}catch(t){U()}}),he=s=>w(void 0,null,function*(){try{return yield L($.GET)(`${E.TASK}/list`,s)}catch(t){U()}}),we=s=>w(void 0,null,function*(){try{return yield L($.DELETE)(`${E.TASK}/delete`,s)}catch(t){U()}}),ke=s=>w(void 0,null,function*(){try{return yield L($.POST)(`${E.TASK}/edit`,s)}catch(t){U()}}),Y=s=>w(void 0,null,function*(){try{return yield L($.PUT)(`${E.TASK}/run`,s)}catch(t){U()}});const ve={class:"list-pagination"},be={__name:"selectModel",props:{showSelectModal:{type:Boolean,default:()=>!1}},emits:["update:showSelectModal","clickedItem"],setup(s,{emit:t}){const i=t,_=s,r=P({get(){return _.showSelectModal},set(o){i("update:showSelectModal",o)}});let k=R({currDirectory:{},tableData:[]});const p=R({page:1,limit:12,count:10});se(()=>_.showSelectModal,o=>{o&&u()},{immediate:!0});const u=()=>w(this,null,function*(){let o={page:p.page,limit:p.limit};try{const c=yield ge(o);if((c==null?void 0:c.code)==200){k.tableData=c==null?void 0:c.data;const{count:b}=c;p.count=b}}catch(c){console.log(c)}}),g=o=>{p.page=o,u()},M=o=>{p.limit=o,u()},z=o=>{k.currDirectory=o},y=()=>{i("clickedItem",k.currDirectory),r.value=!1};return(o,c)=>{const b=f("n-grid-item"),e=f("n-grid"),a=f("n-pagination"),l=f("n-button"),v=f("n-drawer-content"),m=f("n-drawer");return C(),A(m,{show:r.value,"onUpdate:show":c[0]||(c[0]=S=>r.value=S),width:600},{default:d(()=>[n(v,{closable:""},{header:d(()=>[N(" 选择模板 ")]),footer:d(()=>[I("div",ve,[n(a,{page:p.page,"page-size":p.limit,"item-count":p.count,"page-sizes":[12,24,36,48],"onUpdate:page":g,"onUpdate:pageSize":M,"show-size-picker":""},null,8,["page","page-size","item-count"])]),n(l,{type:"info",onClick:y},{default:d(()=>[N("确定")]),_:1})]),default:d(()=>[n(e,{"x-gap":"12","y-gap":"6",cols:2},{default:d(()=>[(C(!0),G(le,null,re(h(k).tableData,(S,T)=>(C(),A(b,{key:T,onClick:D=>z(S),class:ie({selected:h(k).currDirectory.id===S.id})},{default:d(()=>[n(h(Te),{cardData:S},null,8,["cardData"])]),_:2},1032,["onClick","class"]))),128))]),_:1})]),_:1})]),_:1},8,["show"])}}},Me=B(be,[["__scopeId","data-v-7ccc809a"]]),De=["src","alt","fallback-src"],Se=ce({__name:"projectItemCard",props:{cardData:{type:Object,default:()=>{}}},emits:["resize"],setup(s,{emit:t}){const i="http://127.0.0.1:8083",_=s;return(r,k)=>{const p=f("n-card");return C(),A(p,{hoverable:"",title:_.cardData.templateName},{cover:d(()=>[I("img",{src:`${h(i)}/${_.cardData.indexImage}`,alt:s.cardData.templateName,"fallback-src":h(de)()},null,8,De)]),_:1},8,["title"])}}});const Te=B(Se,[["__scopeId","data-v-d88c5968"]]);const xe={class:"btnList"},Ce={__name:"index",props:{showModal:{type:Boolean,default:()=>!1},cycleList:{type:Array,default:()=>[]}},emits:["update:showModal","loadList"],setup(s,{emit:t}){const i=t,_=s,r=R({loading:!1,currData:{},formData:{taskName:"",templateId:"",period:"",periodRange:"week"},showSelectModal:!1}),k=O({taskName:{required:!0,message:"请输入任务名称",trigger:"blur"},templateId:{required:!0,message:"请选择模板",trigger:["blur"]},period:{required:!0,message:"请输入周期时间",trigger:["blur"]},periodRange:{required:!0,message:"请选择周期范围",trigger:["blur"]}}),p=O(null);let u=P(()=>{var y;return(y=r.currData)==null?void 0:y.templateName});const g=P({get(){return _.showModal},set(y){i("update:showModal",y)}}),M=()=>{var y;(y=p.value)==null||y.validate(o=>w(this,null,function*(){if(!o)try{const c=yield ye(r.formData);(c==null?void 0:c.code)===200&&(window.$message.success("新增成功！"),i("update:showModal",!1),i("loadList"))}catch(c){}}))},z=y=>{r.currData=y,r.formData.templateId=r.currData.id};return(y,o)=>{const c=f("n-input"),b=f("n-form-item"),e=f("n-select"),a=f("n-button"),l=f("n-form"),v=f("n-modal");return C(),G("div",null,[n(v,{show:g.value,"onUpdate:show":o[5]||(o[5]=m=>g.value=m),style:{width:"600px"},class:"custom-card",preset:"card",title:"提交表单",size:"huge",bordered:!1},{default:d(()=>[n(l,{"label-width":"80px","label-placement":"left",ref_key:"formRef",ref:p,model:r.formData,rules:k.value,size:"small"},{default:d(()=>[n(b,{label:"任务名称",path:"taskName"},{default:d(()=>[n(c,{value:r.formData.taskName,"onUpdate:value":o[0]||(o[0]=m=>r.formData.taskName=m)},null,8,["value"])]),_:1}),n(b,{label:"周期时间",path:"period"},{default:d(()=>[n(c,{value:r.formData.period,"onUpdate:value":o[1]||(o[1]=m=>r.formData.period=m)},null,8,["value"])]),_:1}),n(b,{label:"周期范围",path:"periodRange"},{default:d(()=>[n(e,{value:r.formData.periodRange,"onUpdate:value":o[2]||(o[2]=m=>r.formData.periodRange=m),options:s.cycleList},null,8,["value","options"])]),_:1}),n(b,{label:"选择模板",path:"templateId"},{default:d(()=>[n(c,{value:h(u),"onUpdate:value":o[3]||(o[3]=m=>Z(u)?u.value=m:u=m),readonly:"",placeholder:"请选择模板"},null,8,["value"]),n(a,{ghost:"",onClick:o[4]||(o[4]=m=>r.showSelectModal=!0)},{default:d(()=>[N("点击选择")]),_:1})]),_:1}),I("div",xe,[n(a,{type:"info",onClick:M,class:"btn"},{default:d(()=>[N(" 提交 ")]),_:1})])]),_:1},8,["model","rules"])]),_:1},8,["show"]),n(h(Me),{showSelectModal:r.showSelectModal,"onUpdate:showSelectModal":o[6]||(o[6]=m=>r.showSelectModal=m),onClickedItem:z},null,8,["showSelectModal"])])}}},Ie=B(Ce,[["__scopeId","data-v-6c8aeb89"]]);const Ne={class:"go-project-task-list"},ze={class:"list-pagination"},Re={__name:"index",setup(s){const t=R({addModelShow:!1,loading:!0,tableData:[],cycleList:[{label:"年",value:"year"},{label:"月",value:"month"},{label:"周",value:"week"},{label:"日",value:"day"},{label:"时",value:"hour"}],searchParam:{name:null,startTime:null,endTime:null,periodRange:null}}),i={year:"年",month:"月",week:"周",day:"日",hour:"时"},_=R({page:1,limit:12,count:10});let r=P({get(){let{startTime:e,endTime:a}=t.searchParam;return!e&&!a?null:[e,a]},set(e){t.searchParam.startTime=(e==null?void 0:e[0])||null,t.searchParam.endTime=(e==null?void 0:e[1])||null}});ue(()=>{u()});const k=[{title:"修改",type:"info",key:"editor",onClick:e=>{e.isEditor==!1&&(e.isEditor=!0)}},{title:"保存",type:"info",key:"save",onClick:e=>{g(e)}},{title:"运行",type:"info",key:"run",onClick:e=>{e.state==-1&&M(e)}},{title:"暂停",type:"info",key:"pause",onClick:e=>{e.state==1&&z(e)}},{title:"删除",type:"error",key:"delete",onClick:e=>{y(e)}}],p=e=>k.find(a=>a.key===e),u=()=>w(this,null,function*(){t.loading=!0;let e=V(H({},t.searchParam),{page:_.page,limit:_.limit});try{const a=yield he(e);if((a==null?void 0:a.code)===200){const{count:l}=a;_.count=l,t.tableData=a.data.map(v=>V(H({},v),{isEditor:!1}))}setTimeout(()=>{t.loading=!1},500)}catch(a){t.loading=!1}}),g=e=>w(this,null,function*(){let a={id:e.id,period:e.period,periodRange:e.periodRange};try{const l=yield ke(a);(l==null?void 0:l.code)==200&&(e.isEditor=!1,window.$message.success("保存成功!"))}catch(l){}}),M=e=>w(this,null,function*(){let a={id:e.id,state:1};try{const l=yield Y(a);(l==null?void 0:l.code)===200&&(window.$message.success("操作成功"),u())}catch(l){}}),z=e=>w(this,null,function*(){let a={id:e.id,state:-1};try{const l=yield Y(a);(l==null?void 0:l.code)===200&&(window.$message.success("操作成功"),u())}catch(l){}}),y=e=>w(this,null,function*(){let a={ids:e.id};try{const l=yield we(a);(l==null?void 0:l.code)===200&&(window.$message.success("删除成功"),u())}catch(l){}}),o=(()=>[{title:"任务名称",key:"taskName"},{title:"模板名称",key:"templateName"},{title:"周期设置",key:"periodRange",width:400,render(e){return e.isEditor?x(fe,{xGap:8},{default:()=>[x(X,{span:12},{default:()=>x(J,{style:{width:"100%"},value:e.period,onInput:a=>e.period=a,size:"small"})}),x(X,{span:12},{default:()=>x(W,{options:t.cycleList,style:{width:"100%"},value:e.periodRange,"onUpdate:value":a=>e.periodRange=a,size:"small"})})]}):x(_e,{style:{width:"100%"},size:"small"},`${e.period}${i[e.periodRange]}/次`)}},{title:"任务状态",key:"state",render(e){return{"-1":"停止",1:"运行"}[e.state]}},{title:"操作",key:"actions",width:200,render(e){const a=[],l=p(e.isEditor?"save":"editor"),v=p(e.state==-1?"run":"pause");let m=p("delete");return a.push(v,l,m),a.map(T=>x(j,{key:T.key,size:"small",type:T.type,tertiary:!0,text:!0,style:{marginRight:"12px"},onClick:()=>T.onClick(e)},{default:()=>T.title}))}}])(),c=e=>{_.page=e,u()},b=e=>{_.limit=e,u()};return(e,a)=>{const l=f("go-loading"),v=f("n-form-item"),m=f("n-form"),S=f("n-data-table"),T=f("n-pagination");return C(),G("div",Ne,[F(I("div",null,[n(l)],512),[[Q,t.loading]]),F(I("div",null,[n(m,{ref:"formRef",inline:"","label-placement":"left","label-width":"auto"},{default:d(()=>[n(v,{label:"名称"},{default:d(()=>[n(h(J),{placeholder:"请输入",value:t.searchParam.name,"onUpdate:value":a[0]||(a[0]=D=>t.searchParam.name=D)},null,8,["value"])]),_:1}),n(v,{label:"任务周期"},{default:d(()=>[n(h(W),{value:t.searchParam.periodRange,"onUpdate:value":a[1]||(a[1]=D=>t.searchParam.periodRange=D),options:t.cycleList,style:{width:"250px"}},null,8,["value","options"])]),_:1}),n(v,{label:"时间范围"},{default:d(()=>[n(h(me),{"formatted-value":h(r),"onUpdate:formattedValue":a[2]||(a[2]=D=>Z(r)?r.value=D:r=D),"value-format":"yyyy-MM-dd HH:mm:ss",format:"yyyy-MM-dd HH:mm:ss",type:"datetimerange",clearable:""},null,8,["formatted-value"])]),_:1}),n(v,null,{default:d(()=>[n(h(j),{ghost:"",onClick:u},{default:d(()=>[N(" 筛选 ")]),_:1})]),_:1}),n(h(j),{ghost:"",onClick:a[3]||(a[3]=()=>t.addModelShow=!0)},{default:d(()=>[N("新增")]),_:1})]),_:1},512),t.addModelShow?(C(),A(Ie,{key:0,showModal:t.addModelShow,"onUpdate:showModal":a[4]||(a[4]=D=>t.addModelShow=D),onLoadList:u,cycleList:t.cycleList},null,8,["showModal","cycleList"])):pe("",!0),n(S,{columns:h(o),data:t.tableData,bordered:!1,"single-line":!1},null,8,["columns","data"])],512),[[Q,!t.loading]]),I("div",ze,[n(T,{page:_.page,"page-size":_.limit,"item-count":_.count,"page-sizes":[12,24,36,48],"onUpdate:page":c,"onUpdate:pageSize":b,"show-size-picker":""},null,8,["page","page-size","item-count"])])])}}},Ue=B(Re,[["__scopeId","data-v-acca8dc8"]]);export{Ue as default};
