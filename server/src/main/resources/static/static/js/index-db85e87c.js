var I=(e,n,u)=>new Promise((p,v)=>{var D=t=>{try{g(u.next(t))}catch(_){v(_)}},d=t=>{try{g(u.throw(t))}catch(_){v(_)}},g=t=>t.done?p(t.value):Promise.resolve(t.value).then(D,d);g((u=u.apply(e,n)).next())});import{a2 as V,a3 as J,a4 as F,a5 as j,d as A,a as W,I as C,W as S,r as P,j as l,k as r,c as $,e as a,w as o,b,n as L,t as B,F as N,l as G,C as y,D as U,f as s,a6 as ie,a7 as ee,z as q,H as re,L as de,M as _e,N as ue,a8 as pe,a9 as me,R as X,Q as Y,U as Z}from"./index-9e787fa5.js";import{i as te}from"./icon-caec1666.js";import{M as ae}from"./index-5e830f33.js";import{g as ge,D as he}from"./plugin-e1dac962.js";const ve=e=>I(void 0,null,function*(){try{return yield V(J.GET)(`${F.PROJECT}/list`,e)}catch(n){j()}}),fe=e=>I(void 0,null,function*(){try{return yield V(J.DELETE)(`${F.PROJECT}/delete`,e)}catch(n){j()}}),be=e=>I(void 0,null,function*(){try{return yield V(J.PUT)(`${F.PROJECT}/publish`,e)}catch(n){j()}}),we={key:0,class:"go-items-list-card"},ye={class:"list-content"},De={class:"list-content-top"},ke={class:"go-flex-items-center list-footer",justify:"space-between"},xe={class:"go-flex-items-center list-footer-ri"},Ce=A({__name:"index",props:{cardData:Object},emits:["preview","delete","resize","edit","release"],setup(e,{emit:n}){var c;const{EllipsisHorizontalCircleSharpIcon:u,CopyIcon:p,TrashIcon:v,PencilIcon:D,DownloadIcon:d,BrowsersOutlineIcon:g,HammerIcon:t,SendIcon:_}=te.ionicons5,i=n,m=e,f=W([{label:C("global.r_edit"),key:"edit",icon:S(t)},{lable:C("global.r_more"),key:"select",icon:S(u)}]),w=P([{label:C("global.r_preview"),key:"preview",icon:S(g)},{label:(c=m.cardData)!=null&&c.release?C("global.r_unpublish"):C("global.r_publish"),key:"release",icon:S(_)},{label:C("global.r_delete"),key:"delete",icon:S(v)}]),x=h=>{switch(h){case"preview":H();break;case"delete":k();break;case"release":T();break;case"edit":R();break}},H=()=>{i("preview",m.cardData)},k=()=>{i("delete",m.cardData)},R=()=>{i("edit",m.cardData)},T=()=>{i("release",m.cardData)},E=()=>{i("resize",m.cardData)};return(h,M)=>{const O=l("n-image"),Q=l("n-text"),ne=l("n-badge"),K=l("n-button"),oe=l("n-dropdown"),se=l("n-tooltip"),ce=l("n-space"),le=l("n-card");return e.cardData?(r(),$("div",we,[a(le,{hoverable:"",size:"small"},{action:o(()=>[b("div",ke,[a(Q,{class:"go-ellipsis-1"},{default:o(()=>[L(B(e.cardData.title||e.cardData.id||"未命名"),1)]),_:1}),b("div",xe,[a(ce,null,{default:o(()=>[a(Q,null,{default:o(()=>[a(ne,{class:"go-animation-twinkle",dot:"",color:e.cardData.release?"#34c749":"#fcbc40"},null,8,["color"]),L(" "+B(e.cardData.release?h.$t("project.release"):h.$t("project.unreleased")),1)]),_:1}),(r(!0),$(N,null,G(f,z=>(r(),$(N,{key:z.key},[z.key==="select"?(r(),y(oe,{key:0,trigger:"hover",placement:"bottom",options:w.value,"show-arrow":!0,onSelect:x},{default:o(()=>[a(K,{size:"small"},{icon:o(()=>[(r(),y(U(z.icon)))]),_:2},1024)]),_:2},1032,["options"])):(r(),y(se,{key:1,placement:"bottom",trigger:"hover"},{trigger:o(()=>[a(K,{size:"small",onClick:Ne=>x(z.key)},{icon:o(()=>[(r(),y(U(z.icon)))]),_:2},1032,["onClick"])]),default:o(()=>[(r(),y(U(z.label)))]),_:2},1024))],64))),128))]),_:1})])])]),default:o(()=>[b("div",ye,[b("div",De,[a(s(ae),{class:"top-btn",hidden:["remove"],onClose:k,onResize:E})]),b("div",{class:"list-content-img",onClick:E},[a(O,{"object-fit":"contain",height:"180","preview-disabled":"",src:`${e.cardData.image}?time=${new Date().getTime()}`,alt:e.cardData.title,"fallback-src":s(ie)()},null,8,["src","alt","fallback-src"])])])]),_:1})])):ee("",!0)}}});const $e=q(Ce,[["__scopeId","data-v-911910f8"]]),He={class:"list-content"},Ee={class:"list-content-img"},ze=["src","alt"],Ie=A({__name:"index",props:{modalShow:{required:!0,type:Boolean},cardData:{required:!0,type:Object}},emits:["close","edit"],setup(e,{emit:n}){const{HammerIcon:u}=te.ionicons5,p=P(!1),v=n,D=e;re(()=>D.modalShow,i=>{p.value=i},{immediate:!0});const d=W([{label:C("global.r_edit"),key:"edit",icon:S(u)}]),g=i=>{switch(i){case"edit":t();break}},t=()=>{v("edit",D.cardData)},_=()=>{v("close")};return(i,m)=>{const f=l("n-text"),w=l("n-space"),x=l("n-time"),H=l("n-badge"),k=l("n-button"),R=l("n-tooltip"),T=l("n-card"),E=l("n-modal");return r(),y(E,{class:"go-modal-box",show:p.value,"onUpdate:show":m[0]||(m[0]=c=>p.value=c),"mask-closable":!0,onAfterLeave:_},{default:o(()=>[a(T,{hoverable:"",size:"small"},{action:o(()=>[a(w,{class:"list-footer",justify:"space-between"},{default:o(()=>[a(f,{depth:"3"},{default:o(()=>[L(B(i.$t("project.last_edit"))+": ",1),a(x,{time:new Date,format:"yyyy-MM-dd hh:mm"},null,8,["time"])]),_:1}),a(w,null,{default:o(()=>[a(f,null,{default:o(()=>{var c,h;return[a(H,{class:"go-animation-twinkle",dot:"",color:(c=e.cardData)!=null&&c.release?"#34c749":"#fcbc40"},null,8,["color"]),L(" "+B((h=e.cardData)!=null&&h.release?i.$t("project.release"):i.$t("project.unreleased")),1)]}),_:1}),(r(!0),$(N,null,G(d,c=>(r(),y(R,{key:c.key,placement:"bottom",trigger:"hover"},{trigger:o(()=>[a(k,{size:"small",onClick:h=>g(c.key)},{icon:o(()=>[(r(),y(U(c.icon)))]),_:2},1032,["onClick"])]),default:o(()=>[(r(),y(U(c.label)))]),_:2},1024))),128))]),_:1})]),_:1})]),default:o(()=>{var c,h;return[b("div",He,[a(w,{class:"list-content-top go-px-0",justify:"center"},{default:o(()=>[a(w,null,{default:o(()=>[a(f,null,{default:o(()=>{var M,O;return[L(B(((M=e.cardData)==null?void 0:M.title)||((O=e.cardData)==null?void 0:O.id)||"未命名"),1)]}),_:1})]),_:1})]),_:1}),a(w,{class:"list-content-top"},{default:o(()=>[a(s(ae),{narrow:!0,hidden:["close"],onRemove:_})]),_:1}),b("div",Ee,[b("img",{src:(c=e.cardData)==null?void 0:c.image,alt:(h=e.cardData)==null?void 0:h.title},null,8,ze)])])]}),_:1})]),_:1},8,["show"])}}});const Se=q(Ie,[["__scopeId","data-v-ad0deb24"]]),je=()=>{const e=P(!1),n=P(null);return{modalData:n,modalShow:e,closeModal:()=>{e.value=!1,n.value=null},resizeHandle:d=>{d&&(e.value=!0,n.value=d)},editHandle:d=>{if(!d)return;const g=de(_e.CHART_HOME_NAME,"href");ue(g,[d.id],void 0,!0)},previewHandle:d=>{pe(me(d.id))}}},Pe=()=>{const e=P(!0),n=W({page:1,limit:12,count:10}),u=P([]),p=()=>I(void 0,null,function*(){e.value=!0;const t=yield ve({page:n.page,limit:n.limit});if(t&&t.data){const{count:_}=t;n.count=_,u.value=t.data.map(i=>{const{id:m,projectName:f,state:w,createTime:x,indexImage:H,createUserId:k}=i;return{id:m,title:f,createId:k,time:x,image:H,release:w!==-1}}),setTimeout(()=>{e.value=!1},500);return}j()}),v=t=>{n.page=t,p()},D=t=>{n.limit=t,p()},d=t=>{ge({type:he.DELETE,promise:!0,onPositiveCallback:()=>new Promise(_=>{_(fe({ids:t.id}))}),promiseResCallback:_=>{if(_.code===X.SUCCESS){window.$message.success(window.$t("global.r_delete_success")),p();return}j()}})},g=(t,_)=>I(void 0,null,function*(){const{id:i,release:m}=t,f=yield be({id:i,state:m?-1:1});if(f&&f.code===X.SUCCESS){if(u.value=[],p(),m){window.$message.success(window.$t("global.r_unpublish_success"));return}window.$message.success(window.$t("global.r_publish_success"));return}j()});return p(),{loading:e,paginat:n,list:u,fetchList:p,releaseHandle:g,changeSize:D,changePage:v,deleteHandle:d}},Re={class:"go-items-list"},Te={class:"list-pagination"},Me=A({__name:"index",setup(e){const{modalData:n,modalShow:u,closeModal:p,previewHandle:v,resizeHandle:D,editHandle:d}=je(),{loading:g,paginat:t,list:_,changeSize:i,changePage:m,releaseHandle:f,deleteHandle:w}=Pe();return(x,H)=>{const k=l("go-loading"),R=l("n-grid-item"),T=l("n-grid"),E=l("n-pagination");return r(),$(N,null,[b("div",Re,[Y(b("div",null,[a(k)],512),[[Z,s(g)]]),Y(b("div",null,[a(T,{"x-gap":20,"y-gap":20,cols:"2 s:2 m:3 l:4 xl:4 xxl:4",responsive:"screen"},{default:o(()=>[(r(!0),$(N,null,G(s(_),(c,h)=>(r(),y(R,{key:c.id},{default:o(()=>[a(s($e),{cardData:c,onPreview:s(v),onResize:s(D),onDelete:M=>s(w)(c),onRelease:M=>s(f)(c,h),onEdit:s(d)},null,8,["cardData","onPreview","onResize","onDelete","onRelease","onEdit"])]),_:2},1024))),128))]),_:1})],512),[[Z,!s(g)]]),b("div",Te,[a(E,{page:s(t).page,"page-size":s(t).limit,"item-count":s(t).count,"page-sizes":[12,24,36,48],"onUpdate:page":s(m),"onUpdate:pageSize":s(i),"show-size-picker":""},null,8,["page","page-size","item-count","onUpdate:page","onUpdate:pageSize"])])]),s(n)?(r(),y(s(Se),{key:0,modalShow:s(u),cardData:s(n),onClose:s(p),onEdit:s(d)},null,8,["modalShow","cardData","onClose","onEdit"])):ee("",!0)],64)}}});const Le=q(Me,[["__scopeId","data-v-87253b62"]]),Be={class:"go-project-items"},Ue=A({__name:"index",setup(e){return(n,u)=>(r(),$("div",Be,[a(s(Le))]))}});const Fe=q(Ue,[["__scopeId","data-v-3dabb86e"]]);export{Fe as default};
